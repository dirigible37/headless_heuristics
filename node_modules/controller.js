define(['problem'], function(problem){
	var controller = function(solvers, solver1name, solver2name, numCities, globalTimeCap, ranges, curProb, callback){
		var currroblem;
		if(curProb == "tsp")
			currProblem = problem.generateRandomTSPProblem(numCities);
		else
			currProblem = problem.generateFunctionProblem(curProb);

		var solver1;
		var solver2;
		run();

		function run(){	//runs algorithms
			var solver1;
			var solver2;
			var solver1Params = {};
			var solver2Params = {};
			solvers[solver1name].Params.forEach(function(v) {
				solver1Params[v.id] = v.value;
			});
			solvers[solver2name].Params.forEach(function(v) {
				solver2Params[v.id] = v.value;
			});

			var solver2ParamNum = solvers[solver2name].Params.length;
			var curTunerProblem = problem.generateTuneProblem(solver2ParamNum, solvers[solver2name], currProblem, ranges, globalTimeCap);
			solver1 = new solvers[solver1name].Solver(curTunerProblem, solver1Params);

			var curSoln;
			var bestSoln = new Array();
			var curScore = 0, bestScore = Number.MAX_VALUE;

			//TODO: Make this run for variable time or iters
			for(var i = 0; i < 50; i++) {
				//console.log("STEP: " + i);
				curSoln = solver1.step();
				curScore = parseFloat(solver1.bestLength).toFixed(4);
				if(Number(curScore) < Number(bestScore)){
					for(var j = 0; j<solvers[solver2name].Params.length; j++) {
						var paramMin = Number(ranges[j].min);
						var paramMax = Number(ranges[j].max);
						var thisSoln = curSoln[0][j];
						//This tunes the parameter
						
						if(solvers[solver2name].Params[j]["type"] == "float")
							bestSoln[j] = Number((paramMin + ((paramMax - paramMin) * thisSoln)).toFixed(2));
						else 
							bestSoln[j] = Math.floor(paramMin + ((paramMax - paramMin) * thisSoln));
					}
					bestScore = curScore;
					//console.log("CURRENT BEST SOLUTION: " + curSoln);
					//console.log("CURRENT BEST PARAMS: " + bestSoln);
					console.log("CURRENT BEST SCORE: " + bestScore);
				}
			}
			console.log("Total Best Solution is: " + bestSoln);
			console.log("Total Best Score is: " + bestScore);
		}
	};
	return controller;
});
